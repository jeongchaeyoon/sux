/*! Copyright (C) StreamUX <http://www.streamux.com> */
/**!
 * @concat js in modules 
 * project sux
 * date 15-03-2018
 * @brief jsux Modules Javascript
 **/
!function(a,b){var c=jsux.app.ListManager,d=jsux.Model.create(c);d.include({addItem:function(a){var b=this,d=function(a){if(c.isEqualItem(b.model,a)||b.model.push(a),a&&a.sub&&a.sub.length>0)for(;a.sub.length>0;){var d=a.sub.splice(0,1);arguments.callee(d[0])}}(a);d=null,this.setData(this.model),this.slideTo(1),this.dispatchEvent({type:"add",target:this,model:a})},getLength:function(){return this.model.length}}),a.getMenuListManager=function(){return new d}}(jsux.app,jQuery),function(a,b){var c=jsux.app.ListManager,d=jsux.Model.create(c);d.include({selectedModels:null,selectedId:"",elid:"",currentItem:null,oldItem:null,dragModels:null,dragMinY:0,dragItem$:null,dragOffsetY:0,moveHeight:0,startOffsetY:0,moveOffsetY:0,oldOffset:0,dragGap:20,isDragging:!1,getModel:function(){return this.model},addItem:function(a){this.selectedModels||(this.selectedModels=this.model),c.isEqualItem(this.selectedModels,a)||this.selectedModels.push(a),this.setData(this.model),this.updateSwiper(),this.resizeSwiper(),this.dispatchEvent({type:"add",target:this,model:a})},cutItem:function(a){if(0!=this.model.length){this.elId=this.id+" > li";var c,d,e=this,f=this.model,g=function(g){for(var h=0;h<g.length;h++){if(g[h].id==a){e.selectedModels=f,c=g.splice(h,1),d=b(e.elId).eq(h);break}g[h]&&g[h].sub&&g[h].sub.length>0&&(e.elId+=" > .sub_mask > ul > li",f=g[h].sub,arguments.callee(g[h].sub))}};return g(f),g=null,this.setData(this.model),this.resizeSwiper(),this.dispatchEvent({type:"add",target:this,model:c}),c[0]}},updateItem:function(a){(function(b){for(var c=0;c<b.length;c++){if(b[c].id==a.id){b[c]=a;break}b[c]&&b[c].sub&&b[c].sub.length>0&&arguments.callee(b[c].sub)}})(this.model);this.setData(this.model),this.dispatchEvent({type:"add",target:this,model:a})},selectMenu:function(a){var d=this;this.elId=this.id+" > li",this.selectedId=a;var e=function(e){for(var f=0;f<e.length;f++)if(e[f].id==a){d.currentItem=b(d.elId).eq(f),d.oldItem&&c.removeClass(d.oldItem,"selected_menu_active"),d.currentItem.hasClass("selected_menu_active")||c.addClass(d.currentItem,"selected_menu_active"),d.oldItem=d.currentItem,d.selectedModels=e[f].sub;break}for(var g=0;g<e.length;g++)e[g]&&e[g].sub&&e[g].sub.length>0&&(d.elId+=" > .sub_mask > ul > li",arguments.callee(e[g].sub))};e(this.model),e=null},unselectMenu:function(){this.oldItem&&c.removeClass(this.oldItem,"selected_menu_active"),this.elId=this.id,this.selectedModels=this.model,this.selectedId=""},editable:function(){this.editState=!0,this.updateEdit()},uneditable:function(){this.editState=!1,this.updateEdit()},updateEdit:function(){var a=this,c=this.id+" > li";this.toggleButtonMode();var d=function(d){for(var e=0;e<d.length;e++){var f=b(c).eq(e);a.setEdittingMode(f,"selected_editing")}for(var g=0;g<d.length;g++)d[g]&&d[g].sub&&d[g].sub.length>0&&(c+=" > .sub_mask > ul > li",arguments.callee(d[g].sub))};d(this.model),d=null,this.setData(this.model),this.updateSwiper()},setEdittingMode:function(a,b){this.editState===!0?c.addClass(a,b):c.removeClass(a,b)},toggleButtonMode:function(){var a=b("button[name=edit_menu]"),d=b("button[name=save_json]"),e="sx-btn-active";this.editState===!0?(c.addClass(d,e),c.removeClass(a,e)):(c.addClass(a,e),c.removeClass(d,e))},remove:function(a){this.dispatchEvent({type:"remove",this:this,collection:this.model})},makeMenu:function(a,d){var e=this,f=0,g=this.id,h=function(a){var h=b(d).tmpl(a).appendTo(g);b(h).css({"padding-left":15*f+"px"}),f=1;for(var i=0;i<a.length;i++){var j=b(h[i]);e.setEdittingMode(j,"selected_editing")}for(var k=0;k<a.length;k++)if(a[k]&&a[k].sub&&a[k].sub.length>0){var j=b(h[k]);c.addClass(j,"icon_folder_active"),g=b(h[k]).find("> div > ul"),arguments.callee(a[k].sub),f=1}};h(a),h=null,0===a.length&&this.setMsg("메뉴를 추가해주세요."),this.updateSwiper(),this.activate()},activate:function(){this.selectedId&&this.selectMenu(this.selectedId)},deactivate:function(a){var d=this;(function(a){c.removeClass(a,"selected_menu_active");var d=b(a).find("> .sub_mask > ul > li");if(d&&d.length>0)for(var e=0;e<d.length;e++)arguments.callee(d[e])})(a);d.elId=d.id,d.selectedModels=d.model,d.selectedId=""},getDragModels:function(a){var b=this.model,c=function(c){for(var d=0;d<c.length;d++)if(c[d].id==a){b=c;break}for(var e=0;e<c.length;e++)c[e]&&c[e].sub&&c[e].sub.length>0&&arguments.callee(c[e].sub)}(this.model);return c=null,b},getParentElement:function(a){return b(a).parent()},getAttr:function(a,c){return b(a).attr(c)},getPageY:function(a){return a.pageY||a.originalEvent.touches[0].pageY},isDraggable:function(a,c){return b(a).data("type")===c},swapArray:function(a,b,c){var d=a[b];return a[b]=a[c],a[c]=d,a},animate:function(a,b,c,d){a.css({top:c}),a.animate({top:0},b,"easeOutQuad",d)},searchDraggable:function(a,b){for(;!this.isDraggable(a,b);)if(a=this.getParentElement(a)[0],!a||null===a.nodeName.toUpperCase().match("BUTTON|LI"))return null;return a},startDrag:function(a,d){var e=d,a=b(a);if(a=this.searchDraggable(a,"item_draggable")){this.lockSwipes(),this.isDragging=!0,this.dragItem$=b(a);var f=this.dragItem$.data("id");this.dragModels=this.getDragModels(f),this.dragMinY=this.dragItem$.parent().offset().top,this.dragOffsetY=this.dragItem$.offset().top,this.moveHeight=this.dragItem$.outerHeight(),this.startOffsetY=e-this.dragOffsetY,c.addClass(this.dragItem$[0],"item_drag_true")}},moveDrag:function(a){if(this.isDragging!==!1){var b=8,c=a,d=c-this.dragOffsetY,e=d-this.startOffsetY,f=this.dragItem$.index(),g=c-this.oldOffset;this.dragMinY+this.startOffsetY;if(g<0){var h=this.dragItem$.prev();if(h&&h.data("id")){var i=h.outerHeight(),j=h.offset().top+this.startOffsetY,k=c-this.startOffsetY;j>k&&(h.insertAfter(this.dragItem$),this.animate(h,300,-1*this.moveHeight),this.swapArray(this.dragModels,f,f-1),e+=i+b,this.dragOffsetY-=i+b)}}else if(g>0){var l=this.dragItem$.next();if(l&&l.data("id")){var m=l.outerHeight(),n=l.offset().top+m,k=c+this.moveHeight;n<k&&(l.insertBefore(this.dragItem$),this.animate(l,300,this.moveHeight),this.swapArray(this.dragModels,f,f+1),e-=m+b,this.dragOffsetY+=m+b)}}this.dragItem$.css({top:e}),this.oldOffset=c}},stopDrag:function(){this.dragItem$&&(this.dragItem$.animate({top:0},300,"easeOutQuad",function(){b(this).css({"z-index":0})}),c.removeClass(this.dragItem$[0],"item_drag_true")),this.unlockSwipes(),this.dragOffsetY=0,this.dragItem$=null,this.isDragging=!1},getLength:function(){return this.model.length},searchTargetElement:function(a,c,d){var e=b(a),f=0,c=c?c:0,d=d?"DIV":d.toUpperCase(),g=new RegExp(d,"gi");do{if(parent&&(g.test(e.data("type"))||g.test(e[0].className)||g.test(e[0].nodeName)))return!0;parent=e.parent(),f++}while(f<c);return!1},initialize:function(a){var c=this;for(var d in a)this[d]=a[d];b(document).on("mousedown",function(a){var d=a.target,e=c.getAttr(d,"name");d.nodeName.toUpperCase();return c.searchTargetElement(a.target,1,"DIV|H1|INPUT|HEADER")?void c.unselectMenu():void(d.nodeName.toUpperCase().match("BUTTON")&&"btn_drag"!==e||(c.startDrag(a.target,a.pageY),b(document).on("mousemove",function(a){a.preventDefault(),c.moveDrag(a.pageY)}),b(document).on("mouseup",function(a){b(document).off("mousemove"),b(document).off("mouseup"),c.stopDrag(a)})))}),b(document).on("touchstart",function(a){var d=a.target,e=c.getAttr(d,"name"),f=d.nodeName.toUpperCase();"I"===f&&(d.nodeName.toUpperCase().match("BUTTON")&&"btn_drag"!==e||(c.startDrag(a.target,a.originalEvent.touches[0].pageY),c.unselectMenu(),c.swiper?c.swiper.on("touchMove",function(a){c.moveDrag(a.touches.currentY)}):b(document).on("touchmove",function(a){a.preventDefault(),c.moveDrag(a.originalEvent.touches[0].pageY)}),b(document).on("touchend",function(a){c.swiper.off("touchMove"),b(document).off("touchend"),c.stopDrag()})))})}}),a.getMenuTreeManager=function(){return new d}}(jsux.app,jQuery),function(a,b){var c=jsux.app.ListManager,d=jsux.View.create();d.include({id:"",tmpl:"",markup:"",model:null,swiper:null,initialize:function(a){for(var b in a)this[b]=a[b]},validate:function(){return this.id?b(this.id).length<1?(jsux.logger.error("'"+this.id+"' 아이디 DOM 객체가 존재하지 않습니다.","menu_manager.js"),!1):(this.markup=b(this.tmpl),!(this.markup.length<1)||(jsux.logger.error("'"+this.id+"' 템플릿 DOM 객체가 존재하지 않습니다.","menu_manager.js"),!1)):(jsux.logger.error("'"+this.id+"' 아이디 식별자를 입력하세요.","menu_manager.js"),!1)},getModel:function(){return this.model},setData:function(a){this.validate()&&(this.model=a||{},this.setLayout(),this.setEvent())},setLayout:function(){b(this.id).find(".sx_menu_info").remove(),b(this.markup).tmpl(this.model).appendTo(this.id),this.swiper=jsux.plugin.createSwiper(".swiper_container_draggable_edit"),this.swiper.update()},setEvent:function(){var a=this;b("form[name=f_admin_menu_modify]").on("submit",function(c){c.preventDefault(),b.each(a.model,function(b,d){c.target[b]&&c.target[b].value&&(a.model[b]=c.target[b].value)}),a.dispatchEvent({type:"submit",target:a,model:a.model})})},showPanel:function(){c.addClass("#SlidingBoxPanel","sx_sliding_box_active")},hidePanel:function(){var a=this;c.removeClass("#SlidingBoxPanel","sx_sliding_box_active"),b("#SlidingBoxPanel").on("transitionend",function(c){b(this).off("transitionend"),a.removePanel()})},removePanel:function(){b(".sx_menu_info").remove()},update:function(a){this.validate()&&(this.model=a||{},this.setLayout(),this.setEvent())}}),a.getMenuInfoView=function(){return new d}}(jsux.app,jQuery),function(a,b){var c=jsux.Class.create();c.extend({UPDATE_COMPLETE:"updateComplete",DELETE_COMPLETE:"deleteComplete",SAVE_COMPLETE:"saveComplete"});var d=jsux.Model.create();d.include({save_url:"",menu_url:"",update:function(a){var b=this;a._method||(a._method="update"),jsux.getJSON(this.menu_url,a,function(a){return"N"===a.result.toUpperCase()?void trace(a.msg):void b.dispatchEvent({type:c.UPDATE_COMPLETE,target:b,event:a})})},delete:function(a){var b=this;a._method||(a._method="delete"),jsux.getJSON(this.menu_url,a,function(a){return"N"===a.result.toUpperCase()?void trace(a.msg):void b.dispatchEvent({type:c.DELETE_COMPLETE,target:b,event:a})})},saveJson:function(a){var b=this;jsux.getJSON(this.save_url,a,function(a){trace(a.msg),b.dispatchEvent({type:c.SAVE_COMPLETE,target:b,event:a})})}}),a.ServiceManagerEvent=c,a.getServiceMonager=function(){return new d}}(jsux.app,jQuery),function(a,b){var c=jsux.app.ServiceManagerEvent;a.fn=jsux.fn||{},a.fn.list={limit:10,limitGroup:5,listManager:jsux.app.getMenuListManager(),treeManager:jsux.app.getMenuTreeManager(),serviceManager:jsux.app.getServiceMonager(),menuInfoView:jsux.app.getMenuInfoView(),listSwiper:null,treeSwiper:null,getMenuModel:function(){var a={id:"",sid:"",category:"",menu_name:"",url:"#",url_target:"_self",depth:1,isClicked:!1,isModified:!1,isDragging:!1,is_active:1,posy:0,state:"default",badge:0,sub:[],top:0,date:""};return a},addMenu:function(a){if(!this.treeManager.hasItem(a)){var b=this.listManager.getItem(a);this.treeManager.addItem(b),this.editableSelectedMenu()}},addCustomizeMenu:function(a){this.treeManager.hasItem(a.id)||(this.treeManager.addItem(a),this.editableSelectedMenu())},addMenues:function(a){var b=this;(function(a){for(var c=0;c<a.length;c++)b.addMenu(a[c].id);for(var d=0;d<a.length;d++)a[d]&&a[d].sub&&a[d].sub.length>0&&(b.selectMenu(a[d].id),arguments.callee(a[d].sub))})(a)},removeTreeMenu:function(a){this.treeManager.hasItem(a)&&this.treeManager.cutItem(a)},selectMenu:function(a){this.treeManager.selectMenu(a)},unselectMenu:function(){this.treeManager.unselectMenu()},editableSelectedMenu:function(){this.treeManager.editable()},uneditableSelectedMenu:function(){this.treeManager.uneditable()},modifyMenuInfo:function(a){var b=this.treeManager.getItem(a);this.menuInfoView.showPanel(),this.menuInfoView.update(b)},canceModifyMenu:function(){this.menuInfoView.hidePanel()},updateModifyInfo:function(){var a=this.menuInfoView.getModel();this.treeManager.updateItem(a),this.serviceManager.update(a)},saveJson:function(){var a={_method:"insert",data:JSON.stringify({data:this.treeManager.getModel()})};this.serviceManager.saveJson(a)},checkLangKor:function(a){var b=/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/;return b.test(a)},checkFormVal:function(a){var c=["메뉴 이름을"],d=["menu_name"],e=!0;return b.each(d,function(b,d){var f=a[d];if(f.value.length<1)return trace(c[b]+" 입력 하세요."),f.focus(),e=!1,!1}),!!e},createCustomizeMenu:function(a){var c=this,d={},e=a;b.each(e,function(a,c){var e="checkbox|button|submit",f=b(c).attr("type")?b(c).attr("type"):c.nodeName;f.match(e)||(d[c.name]=c.value)});var f=new Date,g=c.getMenuModel();g.id=f.getTime(),g.category="menu_"+f.getTime(),b.each(g,function(a){d[a]&&(g[a]=d[a])}),this.addCustomizeMenu(g),this.editableSelectedMenu()},setEvent:function(){var a=this;b("form[name=f_admin_menu_add]").on("submit",function(b){b.preventDefault(),a.checkFormVal(this)&&a.createCustomizeMenu(b.target)}),b("button[name=edit_menu]").on("click",function(b){a.editableSelectedMenu()}),b("button[name=save_json]").on("click",function(b){a.saveJson()})},getConfig:function(){return{gnbJsonUrl:b("input[name=gnb_json_path]").val(),listJsonUrl:b("input[name=list_json_url]").val(),saveJsonUrl:b("input[name=save_json_url]").val(),menuUrl:b("input[name=menu_url]").val(),params:{passover:0,limit:this.limit}}},setListManger:function(){var a=this,c=this.getConfig(),d=jsux.plugin.createSwiper(".swiper_container_item_list"),e=function(a){console.log("type : ",a.type)};return this.listManager.addEventListener("modify",e),this.listManager.addEventListener("remove",e),this.listManager.setResource(c.listJsonUrl),this.listManager.setSwiper(d),this.listManager.initialize({id:"#addableMenuList",tmpl:"#menuListTmpl",msg_tmpl:"#warnMsgTmpl"}),c.listJsonUrl?void jsux.getJSON(c.listJsonUrl,c.params,function(c){var d=c.data;if(d&&d.list&&d.list.length>0){var e=[];b.each(d.list,function(c){var f=a.getMenuModel();b.each(f,function(a){d.list[c][a]&&(f[a]=d.list[c][a])}),e.push(f)}),a.listManager.setData(e),a.listManager.updateSwiper()}else c.msg=c.msg?c.msg:"설정된 메뉴가 존재하지 않습니다.",a.listManager.reset(),a.listManager.setMsg(c.msg)}):void trace("input[name=gnb_json_path] 경로값을 입력하세요")},setTreeManager:function(){var a=this,c=this.getConfig(),d=jsux.plugin.createSwiper(".swiper_container_draggable_list"),e=function(a){};return this.treeManager.addEventListener("loaded",e),this.treeManager.setResource(c.gnbJsonUrl),this.treeManager.setSwiper(d),this.treeManager.initialize({id:"#selectedMenuList",tmpl:"#treeListTmpl",msg_tmpl:"#warnMsgTmpl"}),c.gnbJsonUrl?void jsux.getJSON(c.gnbJsonUrl,c.params,function(c){var d=c.data;if(d&&d.list&&d.list.length>0){var e=[];b.each(d.list,function(c){var f=a.getMenuModel();b.each(f,function(a){d.list[c][a]&&(f[a]=d.list[c][a])}),e.push(f)}),a.treeManager.setData(e),a.treeManager.updateSwiper()}else c.msg=c.msg?c.msg:"설정된 메뉴가 존재하지 않습니다.",a.treeManager.reset(),a.treeManager.setMsg(c.msg)}):void trace("input[name=gnb_json_path] 경로값을 입력하세요")},setServiceManger:function(){var a=this,b=this.getConfig(),d=function(b){switch(b.type){case c.UPDATE_COMPLETE:a.canceModifyMenu();break;case c.DELETE_COMPLETE:break;case c.SAVE_COMPLETE:a.uneditableSelectedMenu()}};this.serviceManager.save_url=b.saveJsonUrl,this.serviceManager.menu_url=b.menuUrl,this.serviceManager.addEventListener(c.UPDATE_COMPLETE,d),this.serviceManager.addEventListener(c.SAVE_COMPLETE,d)},setMenuInfoView:function(){var a=this,b=function(b){a.updateModifyInfo()};this.menuInfoView.initialize({id:"#SlidingBoxPanel",tmpl:"#menuInfoTmpl"}),this.menuInfoView.addEventListener("submit",b)},setLayout:function(){this.setMenuInfoView(),this.setTreeManager(),this.setListManger(),this.setServiceManger()},init:function(){this.setLayout(),this.setEvent()}}}(jsux,jQuery),jsux.fn=jsux.fn||{},jsux.fn.modify={returnUrl:function(){var a=$("input[name=location_back]").val();return a?a:(trace("input[name=location_back] 경로값을 확인해주세요."),"")},getSelectVal:function(a){var b=$.trim($("select[name="+a+"]").val());return b},setSelectVal:function(a,b){$("select[name="+a+"]").val(b)},getCheckboxVal:function(a){var b="",c=$("input:checkbox[name^="+a+"]:checked"),d=c.length;return $(c).each(function(a){b+=c[a].value,a<d-1&&(b+=",")}),b},checkLangKor:function(a){var b=/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/;return b.test(a)},checkFormVal:function(a){var b=["메뉴이름을","링크주소를"],c=["menu_name","url"];return $.each(c,function(c,d){var e=a[d];if(e.value.length<1)return trace(b[c]+" 입력 하세요."),e.focus(),!1}),!0},sendJson:function(a){var b=this,c={},d=a,e=0,f="";$.each(d,function(a,d){var f="checkbox|button|submit",g=$(d).attr("type")?$(d).attr("type"):d.nodeName;if("select"===d.nodeName.toLowerCase()?(d.value=b.getSelectVal(d.name),c[d.name]=d.value):g.match(f)||(c[d.name]=d.value),"checkbox"===g&&d.checked){if(0===e){var h=d.name.substr(0,d.name.length-1);c[h]=b.getCheckboxVal(h)}e++}}),a.action||alert("Not Exists URL"),f=a.action,jsux.getJSON(f,c,function(a){"Y"===a.result.toUpperCase()?jsux.goURL(b.returnUrl()):trace(a.msg)})},setEvent:function(){var a=this;$("form[name=f_admin_menu_modify]").on("submit",function(b){b.preventDefault(),a.checkFormVal(b.target)&&a.sendJson(b.target)})},setLayout:function(){},init:function(){this.setLayout(),this.setEvent()}};